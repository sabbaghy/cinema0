"use strict";var lastFind,userInfo,validateEmail=function(e){return!!/^(([^<>()\[\]\\.,:\s@"]+(\.[^<>()\[\]\\.,:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},validatePasswordModerate=function(e){return!!/(?=(.*[0-9]))((?=.*[A-Za-z0-9])(?=.*[A-Z])(?=.*[a-z]))^.{8,}$/.test(e)},currentYear=(new Date).getFullYear(),arrayErrors=[],defaultFind={title:"",year:"",page:"1"},paginas=[];document.addEventListener("DOMContentLoaded",(function(){var e=location,t=sessionStorage.getItem("sessionActive")||0;(lastFind=JSON.parse(null===sessionStorage.getItem("lastFindDo"))?defaultFind:JSON.parse(sessionStorage.getItem("lastFindDo")),"/"===e.pathname||"/index.html"===e.pathname)&&(0===t?location.href="login.html":(userInfo=JSON.parse(localStorage.getItem("user-"+t))).userFav.length>0?(document.getElementById("fav-title").innerHTML="Las películas favoritas de ".concat(t),showMoviesFav(userInfo.userFav),showFavSection(!0)):showFavSection(!1));if(""===lastFind.title){var a=["superman","batman","star","harry","speed","hard","avengers","rocky","lego"],n=Math.floor(Math.random()*a.length);lastFind.title=a[n],sessionStorage.setItem("lastFindDo",JSON.stringify(lastFind))}findMovies(lastFind.title,lastFind.year,lastFind.page)}));var logout=document.getElementById("logout");logout.addEventListener("click",(function(e){e.preventDefault(),sessionStorage.removeItem("sessionActive"),sessionStorage.removeItem("lastFindDo"),location.href="index.html"}));var searchForm=document.getElementById("search-form"),searchTitle=document.getElementById("search-title"),searchYear=document.getElementById("search-year"),msgError=document.getElementById("msg-error");function findMovies(e,t,a){var n="?s=".concat(e,"&type=movie&y=").concat(t,"&page=").concat(a),o="http://www.omdbapi.com/".concat(n,"&apikey=c52b4a65");fetch(o).then((function(e){return e.json()})).then((function(e){"True"===e.Response&&e.totalResults>0&&showMovies(e.Search)})).catch((function(e){return console.log("se produjo un error ",e)}))}searchForm.addEventListener("submit",(function(e){e.preventDefault(),arrayErrors=[],msgError.innerHTML="",msgError.className="msg-error",checkInputsSearch(),0===arrayErrors.length?(lastFind.title=searchTitle.value.trim(),lastFind.year=searchYear.value.trim(),lastFind.page="1",sessionStorage.setItem("lastFindDo",JSON.stringify(lastFind)),findMovies(searchTitle.value.trim(),searchYear.value.trim(),"1")):(msgError.classList.add("msg-error--show"),arrayErrors.forEach((function(e){msgError.innerHTML+="<p>".concat(e,"</p>")})))}));var findMovieId=function(e){var t="http://www.omdbapi.com/?i=".concat(e,"&apikey=c52b4a65");fetch(t).then((function(e){return e.json()})).then((function(e){document.getElementById("modal-fav").innerHTML="\n               <h3> ".concat(e.Title," se agregó a la lista de favoritos</h3>")})).catch((function(e){return console.log("se produjo un error ",e)}))},showMovies=function(e){var t=document.getElementById("movies"),a="/assets/img/no-image-available.png";t.innerHTML="",e.forEach((function(e){a="N/A"!==e.Poster?e.Poster:"/assets/img/no-image-available.png",t.innerHTML+='\n         <div class="movies-card">\n            <img src="'.concat(a,'" alt="" class="movie-img">\n            <div class="movie-info">\n               <div class="action-btn">\n                  <a onclick="movieSelected(\'').concat(e.imdbID,'\')" class=" btn btn-detail" href="movie.html">Ver Detalle</a>\n                  <p onclick="addFav(\'').concat(e.imdbID,'\')" class=" btn btn-fav">Add <i class="far fa-heart"></i></p>\n               </div>\n            </div>\n         </div>')}))},showMoviesFav=function(e){var t=document.getElementById("fav-movies"),a="/assets/img/no-image-available.png";t.innerHTML="",e.forEach((function(e){var n="http://www.omdbapi.com/?i=".concat(e,"&apikey=c52b4a65");fetch(n).then((function(e){return e.json()})).then((function(e){a="N/A"!==e.Poster?e.Poster:"/assets/img/no-image-available.png",t.innerHTML+='\n               <div class="movies-card">\n                  <img src="'.concat(a,'" alt="" class="movie-img">\n                   <div class="movie-info">\n                     <div class="action-btn">\n                        <a onclick="movieSelected(\'').concat(e.imdbID,'\')" class=" btn btn-detail" href="movie.html">Ver Detalle</a>\n                     </div>\n                  </div>\n               </div>')})).catch((function(e){return console.log("se produjo un error ",e)}))}))},movieSelected=function(e){sessionStorage.setItem("movieId",e)},addFav=function(e){userInfo.userFav.push(e),localStorage.setItem("user-".concat(userInfo.username),JSON.stringify(userInfo)),document.getElementById("fav-title").innerHTML="Las películas favoritas de ".concat(userInfo.username),showMoviesFav(userInfo.userFav),findMovieId(e);var t=document.getElementById("modal-fav");t.classList.add("modal-fav--show"),t.addEventListener("click",(function(e){e.target.classList.contains("modal-fav")&&(t.classList.remove("modal-fav--show"),showFavSection(!0))}))},showFavSection=function(e){var t=document.getElementById("favorite");e?t.classList.add("fav-show"):t.classList.remove("fav-show")},checkInputsSearch=function(){var e=searchTitle.value.trim(),t=searchYear.value.trim();null!==e&&0!==e.length||arrayErrors.push("Debe de indicar el Titulo de la pelicula"),t.length>0&&(isNaN(t)||!/^\d{4}$/.test(t)?arrayErrors.push("el año debe ser numero entero > 999"):t>currentYear&&arrayErrors.push("el año debe ser menor o igual a ".concat(currentYear)))},toggleMenu=document.getElementById("toggle-menu"),mainNav=document.getElementById("main-nav");toggleMenu.addEventListener("click",(function(){mainNav.classList.toggle("main-nav--show"),toggleMenu.classList.toggle("toggle-menu--open")}));